# PPTist AI Backend

This project provides an AI-powered backend for generating PPT outlines and slide content for [PPTist](https://github.com/pipipi-pikachu/PPTist). It is based on the answer to [issue #354](https://github.com/pipipi-pikachu/PPTist/issues/354#issuecomment-2863517189) and now uses [OpenRouter](https://openrouter.ai) for model access.

## Features

- ü§ñ **AI outline generation** ‚Äì Automatically create slide outlines from a topic prompt.
- üé® **Intelligent content generation** ‚Äì Expand outlines into detailed JSON slide content.
- üîÑ **Streaming responses** ‚Äì Receive model output progressively via Server-Sent Events.
- üåê **RESTful API** ‚Äì Straightforward HTTP endpoints for integration.
- üìö **Automatic docs** ‚Äì Interactive OpenAPI documentation powered by FastAPI.

## Tech stack

- **FastAPI** ‚Äì Modern, high-performance Python web framework.
- **LangChain** ‚Äì Prompt orchestration and LLM chaining.
- **OpenRouter** ‚Äì Unified API gateway for a wide range of models.
- **Pydantic** ‚Äì Data validation and settings management.
- **uv** ‚Äì Ultra-fast Python dependency management.

## Quick start

### 1. Environment prerequisites

Ensure you have Python 3.13 or later installed along with [uv](https://docs.astral.sh/uv/).

Install uv with one of the following commands:

```bash
pip install uv
# or
curl -LsSf https://astral.sh/uv/install.sh | sh
# or (Windows PowerShell)
powershell -c "irm https://astral.sh/uv/install.ps1 | iex"
```

### 2. Install dependencies

```bash
uv sync
```

### 3. Configure environment variables

Copy the example environment file and update it with your own values:

```bash
cp .env.example .env
```

Edit `.env` and provide your OpenRouter credentials:

```dotenv
# OpenRouter configuration
OPENROUTER_API_KEY=your-openrouter-api-key-here
OPENROUTER_BASE_URL=https://openrouter.ai/api/v1
# Optional headers recommended by OpenRouter for rate-limit prioritisation
# OPENROUTER_APP_URL=https://your-app-domain
# OPENROUTER_APP_TITLE=PPTist AI Backend

# Model defaults
DEFAULT_MODEL=openrouter/auto
DEFAULT_TEMPERATURE=0.7

# Server configuration
HOST=0.0.0.0
PORT=8000
DEBUG=false
```

### 4. Start the service

```bash
uv run main.py
```

Or run Uvicorn directly:

```bash
uv run uvicorn main:app --host 0.0.0.0 --port 8000
```

The API will be available at [http://localhost:8000](http://localhost:8000).

### 5. Explore the API

Visit [http://localhost:8000/docs](http://localhost:8000/docs) for the autogenerated OpenAPI UI.

### 6. Configure PPTist (optional)

To connect the PPTist frontend to this backend:

1. Clone PPTist and switch to the compatible commit.
2. Update `PPTist/src/services/index.ts` to point `SERVER_URL` to your backend.
3. Adjust the available models in `src/views/Editor/AIPPTDialog.vue` if needed, including the default model selection.
4. (Optional) Update template settings in `src/store/slides.ts` if you add custom templates to this backend's `template` directory.

### 7. Offline usage and custom templates (optional)

You can add your own templates by placing JSON files in the `template` directory. The backend exposes them at `/data/<name>.json`. Remember to convert images to base64 if you need offline assets.

## API Endpoints

### Health check

```http
GET /health
```

### Generate PPT outline

```http
POST /tools/aippt_outline
Content-Type: application/json

{
  "model": "openrouter/auto",
  "language": "English",
  "content": "Applications of AI in education",
  "stream": true
}
```

### Generate PPT content

```http
POST /tools/aippt
Content-Type: application/json

{
  "model": "openrouter/auto",
  "language": "English",
  "content": "# AI in Education\n## Overview\n### Definition\n- ...",
  "stream": true
}
```

## Testing script

Run `test_api.py` to make live requests against a running server. Adjust the sample prompts, models, and language to your needs.

## Deploy to Vercel (free serverless hosting)

You can deploy this API to the free tier of [Vercel](https://vercel.com/) and call it from anywhere without running your own infrastructure.

1. **Create a project** ‚Äì Push this repository to GitHub/GitLab/Bitbucket and import it into Vercel.
2. **Configure environment variables** ‚Äì In the Vercel dashboard, set the following variables in *Project Settings ‚Üí Environment Variables*:

   | Name | Value |
   | --- | --- |
   | `OPENROUTER_API_KEY` | Your OpenRouter API key |
   | `OPENROUTER_BASE_URL` | (Optional) Override the base URL if needed |
   | `OPENROUTER_APP_URL` | (Optional) URL of your deployed app for rate-limit priority |
   | `OPENROUTER_APP_TITLE` | (Optional) Name shown in OpenRouter dashboards |
   | `DEFAULT_MODEL` | (Optional) Model identifier, defaults to `openrouter/auto` |
   | `DEFAULT_TEMPERATURE` | (Optional) Generation temperature, defaults to `0.7` |
   | `DEBUG` | (Optional) Set to `true` to allow all origins during testing |

3. **Deploy** ‚Äì Vercel installs the dependencies listed in `requirements.txt` and exposes the FastAPI app through the serverless entrypoint in `api/index.py`. All routes are available under your project URL, e.g. `https://your-app.vercel.app/tools/aippt`.

The included `vercel.json` routes all incoming traffic to the FastAPI handler, and `mangum` translates Vercel's serverless events into ASGI requests so that streaming endpoints continue to work.

---

The backend now loads prompts from `prompts/ppt_prompts.json`, making it easy to tweak output instructions without touching the codebase.
